<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Car Seat Booking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --primary: #ff3600;
      --primary-dark: #d42d00;
      --bg: #f4f4f6;
      --seat-free: rgba(15, 23, 42, 0.18);
      --seat-selected: rgba(255, 54, 0, 0.85);
      --seat-booked: rgba(15, 23, 42, 0.72);
      --text-dark: #111827;
      --text-muted: #6b7280;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-dark);
      display: flex;
      justify-content: center;
    }

    .page {
      width: 100%;
      max-width: 1100px;
      padding: 24px 16px 40px;
    }

    /* Banner / hero */
    .hero {
      position: relative;
      border-radius: 32px;
      overflow: hidden;
      margin-bottom: 24px;
    }

    .hero img {
      width: 100%;
      display: block;
      height: 220px;
      object-fit: cover;
    }

    .hero-title {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(32px, 5vw, 56px);
      font-weight: 800;
      color: #fff;
      text-shadow: 0 8px 24px rgba(0,0,0,0.45);
    }

    /* MAIN LAYOUT: driver (40%) + booking (60%) */
    .ride-layout {
      display: grid;
      grid-template-columns: 2fr 3fr;  /* ~40 / 60 */
      gap: 24px;
      margin-top: 8px;
    }

    .card {
      background: #fff;
      border-radius: 32px;
      padding: 20px 22px 24px;
      box-shadow: 0 24px 50px rgba(15, 23, 42, 0.10);
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 18px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .driver-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 10px;
    }

    .driver-photo {
      width: 56px;
      height: 56px;
      border-radius: 999px;
      background: #e5e7eb;
      object-fit: cover;
    }

    .driver-name {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 3px;
    }

    .driver-meta {
      font-size: 13px;
      color: #9ca3af;
    }

    .driver-meta span + span::before {
      content: "•";
      margin: 0 4px;
    }

    .driver-bio {
      margin-top: 6px;
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.45;
    }

    /* Trip selector */
    .trip-section {
      margin-top: 18px;
      padding-top: 14px;
      border-top: 1px solid #e5e7eb;
    }

    .trip-section h3 {
      margin: 0 0 8px;
      font-size: 15px;
    }

    .trip-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    .trip-row label {
      font-size: 13px;
      color: var(--text-muted);
    }

    .trip-row input[type="date"],
    .trip-row select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      outline: none;
    }

    .trip-row input[type="date"]:focus,
    .trip-row select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(255, 54, 0, 0.35);
    }

    .trip-hint {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Booking card */
    .booking-card h2 {
      margin: 0 0 6px;
      font-size: 18px;
    }

    .booking-sub {
      margin: 0 0 14px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .booking-body {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
    }

    /* Car + seat grid */
    .car-wrapper {
      position: relative;
      width: 100%;
      max-width: 340px;         /* smaller car */
      border-radius: 28px;
      overflow: hidden;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.25);
    }

    .car-wrapper img {
      width: 100%;
      display: block;
    }

    .seat-grid {
      position: absolute;
      /* Fine-tuned for car-top-vertical.jpg */
      top: 33%;
      left: 29%;
      right: 29%;
      bottom: 26%;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 4px;
      pointer-events: none; /* re-enabled on each tile */
    }

    .seat {
      position: relative;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.20); /* ~80% transparent */
      border: 1px solid rgba(255, 255, 255, 0.18);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 6px 4px;
      cursor: pointer;
      transition: 0.18s ease all;
      user-select: none;
      pointer-events: auto;
      color: #e5e7eb;
    }

    .seat.disabled {
      cursor: default;
      pointer-events: none;
      opacity: 0.5;
    }

    .seat.driver-seat {
      background: rgba(0,0,0,0.65);
      cursor: default;
      pointer-events: none;
    }

    .seat-icon {
      width: 22px;
      height: 22px;
      margin-bottom: 3px;
      object-fit: contain;
    }

    .seat-title {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    .seat-subtitle {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #d1d5db;
      margin-top: 2px;
    }

    .seat-status-label {
      position: absolute;
      top: 5px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #fef2f2;
      opacity: 0;
      pointer-events: none;
    }

    .seat.selected {
      background: var(--seat-selected);
      border-color: rgba(255, 255, 255, 0.75);
      box-shadow: 0 12px 30px rgba(248, 113, 113, 0.55);
      transform: translateY(-1px);
    }

    .seat.booked {
      background: var(--seat-booked);
      border-color: rgba(156, 163, 175, 0.5);
      box-shadow: none;
      transform: none;
    }

    .seat.booked .seat-status-label {
      opacity: 0.95;
    }

    .seat.driver-seat .seat-status-label {
      display: none;
    }

    .car-disabled-overlay {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.45);
      color: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 13px;
      padding: 12px;
      pointer-events: none;
      opacity: 0;
      transition: 0.18s ease opacity;
    }

    .car-wrapper.disabled .car-disabled-overlay {
      opacity: 1;
    }

    /* Status + legends */
    .status {
      font-size: 13px;
      color: var(--text-muted);
      text-align: center;
    }
    .status strong { color: var(--primary-dark); }

    .legend {
      display: flex;
      gap: 16px;
      justify-content: center;
      font-size: 12px;
      margin-top: 8px;
      color: var(--text-muted);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      border: 2px solid #9ca3af;
    }

    .legend-dot.free     { background: var(--seat-free); }
    .legend-dot.selected { background: var(--seat-selected); border-color: var(--seat-selected); }
    .legend-dot.booked   { background: var(--seat-booked); border-color: var(--seat-booked); }

    /* Button + messages */
    .btn {
      margin-top: 14px;
      padding: 12px 30px;
      border-radius: 999px;
      border: none;
      background: var(--primary);
      color: #fff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 14px 36px rgba(248, 113, 113, 0.45);
      transition: 0.18s ease all;
    }
    .btn:hover:not(:disabled) {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }
    .btn:disabled {
      background: #c2c2c7;
      box-shadow: none;
      cursor: not-allowed;
    }

    .message {
      margin-top: 8px;
      font-size: 13px;
      text-align: center;
    }
    .message.ok { color: #059669; }
    .message.error { color: #dc2626; }

    @media (max-width: 900px) {
      .ride-layout {
        grid-template-columns: 1fr;
      }
      .car-wrapper {
        max-width: 260px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- TOP BANNER -->
    <header class="hero">
      <img src="banner.jpg" alt="Car banner">
      <div class="hero-title">Select Your Car Seat</div>
    </header>

    <!-- MAIN 2-COLUMN LAYOUT -->
    <section class="ride-layout">
      <!-- LEFT: DRIVER + TRIP -->
      <aside class="card">
        <h2>Your Driver</h2>
        <div class="driver-header">
          <img src="driver-photo.jpg" alt="Photo of your driver" class="driver-photo">
          <div>
            <div class="driver-name">Aleš Krajina</div>
            <div class="driver-meta">
              <span>4.9 ★ rating</span>
              <span>120+ rides</span>
              <span>Non-smoker</span>
            </div>
          </div>
        </div>
        <div class="driver-bio">
          Czech guy in Switzerland, driving a graphite-silver Arteon R-Line.
          I like mountains, good music and making sure your ride is safe, on time
          and comfortable.
        </div>

        <!-- Trip selection -->
        <div class="trip-section">
          <h3>Choose your trip</h3>

          <div class="trip-row">
            <label for="tripDate">Date</label>
            <input id="tripDate" type="date">
          </div>

          <div class="trip-row">
            <label for="tripRoute">Route</label>
            <select id="tripRoute">
              <option value="">Select route…</option>
              <option value="ZRH-OVA">Zürich → Ostrava</option>
              <option value="OVA-ZRH">Ostrava → Zürich</option>
            </select>
          </div>

          <p class="trip-hint">
            Seat availability is stored per <strong>date + route</strong>.  
            Pick your trip first, then choose your seats.
          </p>
        </div>
      </aside>

      <!-- RIGHT: BOOKING / CAR -->
      <section class="card booking-card">
        <h2>Choose your place in the Arteon</h2>
        <p class="booking-sub">
          Tap on one or more seats inside the car to reserve your spots for the selected trip.
        </p>

        <div class="booking-body">
          <div id="carWrapper" class="car-wrapper disabled" aria-label="Seat selection on top-down car">
            <img src="car-top-vertical.jpg" alt="Top-down view of the car">
            <div class="seat-grid">
              <!-- DRIVER (non-selectable) -->
              <div class="seat driver-seat" data-seat-id="DRIVER">
                <span class="seat-status-label"></span>
                <img src="driver-wheel.png" alt="Driver" class="seat-icon">
                <div class="seat-title">Driver</div>
                <div class="seat-subtitle">Non bookable</div>
              </div>

              <!-- VIP CO-PILOT -->
              <div class="seat" data-seat-id="VIP">
                <span class="seat-status-label"></span>
                <img src="/mnt/data/34dec8fd-6199-4649-98d1-2c42e07ecd34.png" alt="VIP icon" class="seat-icon">
                <div class="seat-title">VIP</div>
                <div class="seat-subtitle">Co-Pilot</div>
              </div>

              <!-- Back left – Mood Bringer -->
              <div class="seat" data-seat-id="MB">
                <span class="seat-status-label"></span>
                <div class="seat-title">Mood Bringer</div>
                <div class="seat-subtitle">Back seat</div>
              </div>

              <!-- Back right – Storyteller -->
              <div class="seat" data-seat-id="ST">
                <span class="seat-status-label"></span>
                <div class="seat-title">Storyteller</div>
                <div class="seat-subtitle">Back seat</div>
              </div>
            </div>

            <div class="car-disabled-overlay" id="carDisabledOverlay">
              Pick a date and route on the left to select seats.
            </div>
          </div>

          <!-- Status text -->
          <div id="seatStatus" class="status">
            Select a date and route to see available seats.
          </div>

          <!-- Legend -->
          <div class="legend" aria-hidden="true">
            <div class="legend-item">
              <span class="legend-dot free"></span> Free
            </div>
            <div class="legend-item">
              <span class="legend-dot selected"></span> Selected
            </div>
            <div class="legend-item">
              <span class="legend-dot booked"></span> Booked
            </div>
          </div>

          <!-- Confirm button + message -->
          <button id="confirmBtn" class="btn" disabled>Confirm Booking</button>
          <div id="message" class="message"></div>
        </div>
      </section>
    </section>
  </div>

  <script>
    /*********************************************************
     * SIMPLE PER-TRIP SEAT STORAGE
     * Key = date + '|' + route (e.g. "2025-11-20|ZRH-OVA")
     * Value = { VIP: true, MB: true, ST: true }  (booked seats)
     *********************************************************/
    const STORAGE_KEY = "arteonSeatBookings_v3";

    function loadStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return {};
        return JSON.parse(raw);
      } catch (e) {
        console.warn("Cannot read storage", e);
        return {};
      }
    }

    function saveStorage(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    const state = {
      storage: loadStorage(),
      currentTripKey: null,
      selectedSeats: []          // array of seat IDs chosen in this session
    };

    const tripDateEl   = document.getElementById("tripDate");
    const tripRouteEl  = document.getElementById("tripRoute");
    const carWrapperEl = document.getElementById("carWrapper");
    const seatStatusEl = document.getElementById("seatStatus");
    const confirmBtn   = document.getElementById("confirmBtn");
    const messageEl    = document.getElementById("message");
    const carOverlayEl = document.getElementById("carDisabledOverlay");

    const seatEls = Array.from(
      document.querySelectorAll(".seat-grid .seat")
    ).filter(el => !el.classList.contains("driver-seat"));

    function getCurrentTripKey() {
      const d = tripDateEl.value;
      const r = tripRouteEl.value;
      if (!d || !r) return null;
      return d + "|" + r;
    }

    function getTripBookings(tripKey) {
      if (!tripKey) return {};
      return state.storage[tripKey] || {};
    }

    function setTripBookings(tripKey, bookings) {
      state.storage[tripKey] = bookings;
      saveStorage(state.storage);
    }

    function updateUI() {
      const tripKey = state.currentTripKey = getCurrentTripKey();
      const hasTrip = !!tripKey;

      // Enable / disable car wrapper
      if (!hasTrip) {
        carWrapperEl.classList.add("disabled");
      } else {
        carWrapperEl.classList.remove("disabled");
      }

      const bookings = getTripBookings(tripKey);

      let freeCount = 0;
      let bookedCount = 0;

      seatEls.forEach(el => {
        const seatId = el.dataset.seatId;
        const isBooked = !!bookings[seatId];
        const isSelected = state.selectedSeats.includes(seatId);
        const statusLabel = el.querySelector(".seat-status-label");

        el.classList.remove("booked", "selected", "disabled");

        if (!hasTrip) {
          el.classList.add("disabled");
          if (statusLabel) statusLabel.textContent = "";
          return;
        }

        if (isBooked) {
          el.classList.add("booked");
          bookedCount++;
          if (statusLabel) statusLabel.textContent = "BOOKED";
        } else {
          freeCount++;
          if (statusLabel) statusLabel.textContent = "";
          if (isSelected) {
            el.classList.add("selected");
          }
        }
      });

      // Update status text
      if (!hasTrip) {
        seatStatusEl.innerHTML = "Select a date and route to see available seats.";
        carOverlayEl.style.display = "flex";
      } else {
        carOverlayEl.style.display = "none";
        const selectedCount = state.selectedSeats.length;
        seatStatusEl.innerHTML =
          `Free seats: <strong>${freeCount}</strong> · ` +
          `Booked: <strong>${bookedCount}</strong> · ` +
          `Selected: <strong>${selectedCount || "None"}</strong>`;
      }

      // Confirm button
      confirmBtn.disabled = !hasTrip || state.selectedSeats.length === 0;
    }

    // Seat click handling (multiple selection)
    seatEls.forEach(el => {
      el.addEventListener("click", () => {
        const tripKey = getCurrentTripKey();
        if (!tripKey) return; // guard

        const bookings = getTripBookings(tripKey);
        const seatId = el.dataset.seatId;

        if (bookings[seatId]) return; // already booked, ignore

        // Toggle selection
        const idx = state.selectedSeats.indexOf(seatId);
        if (idx >= 0) {
          state.selectedSeats.splice(idx, 1);
        } else {
          state.selectedSeats.push(seatId);
        }
        updateUI();
      });
    });

    // Trip selectors
    tripDateEl.addEventListener("change", () => {
      state.selectedSeats = [];
      messageEl.textContent = "";
      updateUI();
    });

    tripRouteEl.addEventListener("change", () => {
      state.selectedSeats = [];
      messageEl.textContent = "";
      updateUI();
    });

    // Confirm booking
    confirmBtn.addEventListener("click", () => {
      const tripKey = getCurrentTripKey();
      if (!tripKey || state.selectedSeats.length === 0) return;

      const bookings = getTripBookings(tripKey);
      state.selectedSeats.forEach(id => {
        bookings[id] = true; // mark as booked
      });
      setTripBookings(tripKey, bookings);

      const bookedNow = state.selectedSeats.slice();
      state.selectedSeats = [];

      updateUI();

      messageEl.className = "message ok";
      messageEl.textContent =
        "Nice! You’ve booked: " + bookedNow.join(", ") +
        " for " + tripKey.replace("|", " – ");
    });

    // Initial paint
    updateUI();
  </script>
</body>
</html>
